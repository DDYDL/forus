<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.hospital">
    <!-- 위치 기반으로 병원 조회 -->
    <select id="findHospitalByLocation" parameterType="map" resultType="dto.Hospital">
        <![CDATA[
        SELECT
            h.h_id,
            h.h_name,
            h.h_address,
            h.h_latitude,
            h.h_longitude,
            h.h_animal_type,
            (
                    ST_Distance_Sphere(
                            point(#{longitude}, #{latitude}),
                            point(h.h_longitude, h.h_latitude)
                    ) / 1000
                ) AS distance
        FROM
            hospital h
        WHERE
                (
                        ST_Distance_Sphere(
                                point(#{longitude}, #{latitude}),
                                point(h.h_longitude, h.h_latitude)
                        ) / 1000
                    ) <= #{radius}
        ORDER BY
            distance ASC;
        ]]>
    </select>
</mapper>