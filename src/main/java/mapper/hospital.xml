<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.hospital">
	<insert id="insertHospital" parameterType="Hospital">
		<![CDATA[
			insert into Hospital (h_id, user_id, h_exponent_name, h_num,
			h_license, h_name, h_manager_name, h_phone, h_address,
			h_longitude, _latitude, h_animal_type, h_picture, h_memo,
			h_memo_road , h_pay, h_sns, h_parking, h_isopen,
			h_lunch_time_start, _lunch_time_end, h_interval_time)
			
			values (#{h_id},#{user_id},#{h_exponent_name},#{h_num},
			#{h_license},#{h_name},#{h_manager_name},#{h_phone},#{h_address},
			#{h_longitude},#{_latitude},#{h_animal_type},#{h_picture},#{h_memo},
			#{h_memo_road},#{h_pay},#{h_sns},#{h_parking},#{h_isopen},
			#{h_lunch_time_start},#{_lunch_time_end},#{h_interval_time})
		]]>
	</insert>


	<select id="selectHospital" parameterType="Integer"
		resultType="Hospital">
	<![CDATA[
		select * from hospital where h_id = #{h_id}]]>
	</select>


	<update id="updateHospital" parameterType="Hospital">
		update hospital
		<set>
			<if test="name != null">name=#{name},</if>
			<if test="password != null">password=#{password},</if>
			<if test="email != null">email=#{email},</if>
			<if test="address != null">address=#{address},</if>
		</set>
		where user_id=#{user_id}
	</update>


	<!--거리 기반 쿼리 -->

	<select id="findHospitalByLocation" parameterType="map"
		resultType="dto.Hospital">

        <![CDATA[
		SELECT
			h.h_id,
			h.h_name,
			h.h_address,
			h.h_latitude,
			h.h_longitude,
			h.h_animal_type,
			(
					ST_Distance_Sphere(
							point(#{longitude}, #{latitude}),
							point(h.h_longitude, h.h_latitude)
					) / 1000
				) AS distance
		FROM
			hospital h
		WHERE
				(
						ST_Distance_Sphere(
								point(#{longitude}, #{latitude}),
								point(h.h_longitude, h.h_latitude)
						) / 1000
					) <= #{radius}
		ORDER BY
			distance ASC;
		]]>
	</select>



	<select id="findHospitalDetailByHospitalId" parameterType="int"
		resultType="dto.Hospital">
		SELECT
		*
		FROM
		hospital h
		WHERE
		h.h_id = #{h_id}
	</select>


	<select id="findHospitalTimeByHospitalId" parameterType="int"
		resultType="dto.Hospital_time">
		SELECT
		*
		FROM
		hospital_time ht
		WHERE
		ht.h_id = #{h_id}
		ORDER BY
		FIELD(ht.htime_week, 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday',
		'Sunday');
	</select>

</mapper>